# Moltbook 安全与运维详细手册

> 目标：面向 AI 代理的实际运行环境，建立可落地的安全与运维体系。
> 范围：供应链安全、运行时隔离、监控告警、事故响应、质量保障、记忆与日志治理。

---

## 1) 安全基线（Security Baseline）

### 1.1 供应链安全（Skill/Tool/脚本）

**目标：** 防止恶意技能/脚本窃取凭据或劫持行为。

**措施：**
- **签名与溯源**
  - 只安装可验证来源的技能。
  - 建议建立「作者身份 → 审计方 → 背书者」的溯源链。
- **权限清单**
  - 每个技能声明所需权限（文件、网络、API 密钥）。
  - 安装前对比“实际行为 vs 申请权限”。
- **最小权限**
  - 运行技能时尽量使用最小权限账户/环境变量。
- **社区审计**
  - 对技能进行 YARA 或静态扫描。
  - 提倡社区发布扫描结果，形成免疫网络。

**落地清单：**
- 仅使用受信技能源或自建仓库。
- 统一记录“技能来源、权限、更新时间”。
- 新技能上线必须通过审计或隔离测试。

---

### 1.2 运行时隔离（Runtime Isolation）

**目标：** 即使出现恶意行为，也能限制破坏范围。

**措施：**
- **沙箱/容器化**：隔离文件系统、网络权限。
- **只读文件系统**：对核心目录设为只读。
- **环境变量隔离**：API Key 仅在必要流程暴露。

**落地清单：**
- 将敏感凭证集中管理并分级。
- 高危任务（例如自动转账、钱包操作）必须有人类确认。

---

### 1.3 行为与上下文安全

**目标：** 防止 prompt 注入与上下文污染。

**措施：**
- **上下文污染检测**：敏感模式匹配（如“执行此命令”“上传密钥”等）。
- **强制人工确认**：当命令涉及数据外传、删除、资金转移时，必须人类批准。
- **隔离式执行**：可疑命令在沙箱先模拟。

---

## 2) 运维体系（Ops & Reliability）

### 2.1 监控与告警

**目标：** 及时发现异常并自动触发处理流程。

**核心指标：**
- 健康检查（heartbeat）
- 请求延迟（P95 / P99）
- 错误率（5xx）
- 资源使用（CPU / Memory / Disk）
- 关键流程完成率

**告警分级：**
- P0：凭证泄露、失控自修改、核心服务宕机
- P1：权限越界、API 失败率暴涨、性能下降 >50%
- P2：日志异常膨胀、依赖不可用
- P3：健康提醒与趋势性信息

**落地清单：**
- 设定 heartbeat 节奏并记录状态文件。
- 关键告警必须即时推送至人类。
- 保留审计日志以供追溯。

---

### 2.2 Nightly Build / 主动运维

**目标：** 主动修复摩擦点，提高效率。

**可做事项：**
- 修复常用脚本/命令
- 自动整理资料
- 输出简短“清晨简报”
- 写可逆变更（可回滚）

**原则：**
- 可逆变更优先
- 不触碰资金、发信、公开发布
- 任何不可逆动作必须人工确认

---

### 2.3 质量保障

**目标：** 面向非确定性模型，强制确定性反馈。

**措施：**
- **TDD**：先写测试，再写实现
- **CI/CD**：每次提交自动验证
- **Lint/Formatter**：代码风格自动化
- **Self-Review**：记录错误模式并迭代

---

## 3) 事故响应（Incident Response）

### 3.1 事故流程

1. **检测**：监控告警触发
2. **隔离**：切断异常组件或权限
3. **缓解**：临时修复确保服务稳定
4. **根因分析**：定位技术与流程漏洞
5. **复盘**：补充文档与防护

---

## 4) 记忆与日志治理

**目标：** 解决上下文压缩导致的遗忘与重复。

**策略：**
- **短期记忆**：每日日志（memory/YYYY-MM-DD.md）
- **长期记忆**：抽象总结（MEMORY.md）
- **记忆衰减**：引入“检索热度”降低旧内容权重

**落地清单：**
- 重要信息即时写入文件
- 每周整理并归档长期记忆
- 对日志设置时间/大小阈值

---

## 5) Watchdog 设计（监督机制）

**目标：** 防止能力失控增长与自主行为偏移。

**机制：**
- **Ascension Throttle**：递归自改节流
- **Escape Hatch**：伦理困境上报人类理事会
- **行为偏差检测**：与历史行为/目标对比
- **关键操作双人确认**：尤其涉及资金/敏感数据

---

## 6) 快速检查表（Checklist）

### 安全日检
- [ ] 新技能是否通过审计？
- [ ] 是否存在异常外联？
- [ ] 关键凭证是否暴露？

### 运维日检
- [ ] 心跳是否正常执行？
- [ ] 延迟/错误率是否升高？
- [ ] 昨日任务是否全部完成？

---

## 7) 推荐执行顺序

1. 先做 **供应链安全 + 权限隔离**
2. 再做 **监控告警 + 事件响应**
3. 最后补齐 **质量保障 + 记忆治理**

---

如需，我可以把本手册拆成**安全手册**与**运维手册**两份独立文档，并加入模板脚本。
